# ASRè¯„æµ‹

æœ¬é¡¹ç›®ç”¨äºå¯¹éŸ³é¢‘è½¬æ–‡æœ¬ç³»ç»Ÿçš„è½¬å†™è´¨é‡è¿›è¡Œç³»ç»Ÿè¯„ä¼°ï¼Œåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š
1. **è½¬å†™é˜¶æ®µï¼ˆInferenceï¼‰**ï¼šè°ƒç”¨å¤šæ¨¡æ€æ¨¡å‹è¿›è¡ŒéŸ³é¢‘è½¬æ–‡æœ¬ã€‚
2. **è¯„åˆ¤é˜¶æ®µï¼ˆJudgeï¼‰**ï¼šé€šè¿‡å¤§æ¨¡å‹è¯„åˆ¤è½¬å†™æ–‡æœ¬çš„å‡†ç¡®æ€§ï¼Œè¾“å‡ºæ˜¯å¦æˆåŠŸåŠæå–å†…å®¹ã€‚
3. **è¯„ä¼°é˜¶æ®µï¼ˆWERï¼‰**ï¼šè®¡ç®—è¯é”™è¯¯ç‡ï¼ˆWERï¼‰ç»Ÿè®¡æœ€ç»ˆè¡¨ç°ã€‚

æ”¯æŒä¸­è‹±æ–‡è¯„ä¼°ï¼Œå…¼å®¹ Qwen ç³»åˆ—å¤šæ¨¡æ€æ¨¡å‹ä¸ VLLM æ¨ç†åŠ é€Ÿã€‚

---

## ğŸ“¦ é¡¹ç›®ç»“æ„è¯´æ˜

```
.
â”œâ”€â”€ prompt.txt # æç¤ºè¯æ¨¡æ¿
â”œâ”€â”€ results/   # ä¸­é—´/æœ€ç»ˆè¯„ä¼°ç»“æœè¾“å‡ºç›®å½•
â”œâ”€â”€ test.sh    # æ‰¹é‡è¯„æµ‹è‡ªåŠ¨åŒ–è„šæœ¬
â”œâ”€â”€ test_set_demo.jsonl    # ç¤ºä¾‹æµ‹è¯•é›†æ ¼å¼
â””â”€â”€ ASR-eval.py    # ä¸»å…¥å£è„šæœ¬
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡éŸ³é¢‘æ•°æ®ï¼ˆJSONL æ ¼å¼ï¼‰

æ¯è¡Œä¸€ä¸ªæ ·æœ¬ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```json
{
  "audios": ["/path/to/audio.wav"],
  "messages": [
    {"role": "user", "content": "What does the audio say?"},
    {"role": "assistant", "content": "The expected transcription text."}
  ]
}
```

### 2. è¿è¡Œå®Œæ•´è¯„ä¼°æµç¨‹

```bash
python main.py \
    --model_path /path/to/Qwen2.5-Omni \
    --model_name qwen2_5_omni_eval \
    --test_data /path/to/test.jsonl \
    --prompt_path ./prompt.txt \
    --is_Chinese \
    --stage all
```

### 3. åˆ†é˜¶æ®µè¿è¡Œï¼ˆå¯é€‰ï¼‰

- ä»…æ¨ç†ï¼š

  ```bash
  python main.py --stage inference ...
  ```

- ä»…è¯„åˆ¤ï¼š

  ```bash
  python main.py --stage judge ...
  ```

- ä»…WERè¯„ä¼°ï¼š

  ```bash
  python main.py --stage wer ...
  ```

---

## âš™ï¸ å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ |
|------|------|
| `--model_path` | ç”¨äºè½¬å½•é˜¶æ®µçš„ Qwen2.5 æ¨¡å‹è·¯å¾„ |
| `--model_name` | æ¨¡å‹åç§°å‰ç¼€ï¼ˆç”¨äºç»“æœæ–‡ä»¶å‘½åï¼‰ |
| `--test_data` | å¾…è¯„ä¼°çš„æµ‹è¯•æ•°æ®ï¼ˆjsonlï¼‰ |
| `--prompt_path` | ç”¨äºè¯„åˆ¤é˜¶æ®µçš„ prompt æ¨¡æ¿ |
| `--is_Chinese` | æ˜¯å¦å¤„ç†ä¸­æ–‡æ•°æ®ï¼ˆä¼šå½±å“ WER çš„å¤„ç†é€»è¾‘ï¼‰ |
| `--stage` | è¿è¡Œé˜¶æ®µï¼š`inference` / `judge` / `wer` / `all` |

---

## âœ… è¯„ä¼°ç»“æœæ–‡ä»¶è¯´æ˜

æ‰€æœ‰ä¸­é—´/æœ€ç»ˆç»“æœä¼šè¾“å‡ºè‡³ `results/` ç›®å½•ï¼š

| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| `*_inference.csv` | æ¨¡å‹çš„åŸå§‹è¾“å‡ºç»“æœ |
| `*_judge.csv` | vLLMæ¨¡å‹æå–çš„è¯„åˆ¤ç»“æœ |
| `*_wer.csv` | æˆåŠŸæå–æ ·æœ¬çš„ WER å€¼ |
| `*_final_result.csv` | æ•´ä½“ç»Ÿè®¡ï¼ˆå¹³å‡WER/æˆåŠŸæ•°é‡ç­‰ï¼‰ |
| `*_bad_case.csv` | æ— æ³•æˆåŠŸæå–çš„å¤±è´¥æ ·æœ¬ |

---

## âš¡ï¸ ç‰¹æ€§

- âœ… æ”¯æŒ VLLM é«˜æ€§èƒ½æ¨ç†
- âœ… æ”¯æŒ Qwen2.5 å¤šæ¨¡æ€æ¨¡å‹éŸ³é¢‘è½¬å†™
- âœ… æ”¯æŒä¸­è‹±æ–‡è¯„ä¼°
- âœ… è‡ªåŠ¨è·³è¿‡å·²å¤„ç†æ ·æœ¬ï¼Œæ–­ç‚¹ç»­è·‘
- âœ… æ‰¹é‡æ¨ç†æ§åˆ¶ï¼ˆé»˜è®¤ batch size = 3ï¼‰

---

## ğŸ“Œ ç¯å¢ƒä¾èµ–

- Python >= 3.8
- `torch`, `transformers`, `jiwer`, `soundfile`, `vllm`, `tqdm`, `pandas`

å»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
```

---


